
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Report {
  id        Int      @id @default(autoincrement())
  type      String
  note      String?
  lat       Float
  lng       Float
  level     Int?
  createdAt DateTime @default(now())
  // Optional: simple category filter to extract sustainability POIs
  // store as types like 'water_refill','recycling','shade_rest','bike_repair', etc.
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String   @unique
  password  String   // hashed
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Location tracking
  lastLat   Float?
  lastLng   Float?
  lastSeen  DateTime?
  
  // Buddy requests
  sentRequests     BuddyRequest[] @relation("Sender")
  receivedRequests BuddyRequest[] @relation("Receiver")
  
  // Messages
  sentMessages     Message[] @relation("MessageSender")
  receivedMessages Message[] @relation("MessageReceiver")
}

model BuddyRequest {
  id        Int      @id @default(autoincrement())
  senderId  Int
  receiverId Int
  status    String   // 'pending', 'accepted', 'rejected', 'cancelled'
  message   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  sender    User     @relation("Sender", fields: [senderId], references: [id])
  receiver  User     @relation("Receiver", fields: [receiverId], references: [id])
  
  @@unique([senderId, receiverId])
  @@index([receiverId, status])
}

model Message {
  id        Int      @id @default(autoincrement())
  senderId  Int
  receiverId Int
  content   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  
  sender    User     @relation("MessageSender", fields: [senderId], references: [id])
  receiver  User     @relation("MessageReceiver", fields: [receiverId], references: [id])
  
  @@index([receiverId, read])
  @@index([senderId, receiverId, createdAt])
}
